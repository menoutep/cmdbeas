{% extends 'application/index.html' %}
{% load static %}

{% block content %}

<style>
    body {
        font-family: Arial, sans-serif;
    }
    
    ul {
        list-style-type: none;
        padding-left: 20px;
        margin-left: 20px;
    }
    
    li {
        margin-bottom: 5px;
        margin-left: 7px;
        padding-left: 10px;
    }
    
    .expand-btn {
        cursor: pointer;
        padding: 3px;
        border-radius: 3px;
        margin-right: 5px; /* Ajout de la marge à droite pour séparer l'icône du texte */
        display: inline-block; /* Affichage en ligne pour permettre le positionnement horizontal */
    }
    
    .expand-btn:hover {
        background-color: #f0f0f0;
    }
    
    ul.hidden {
        display: none;
    }

    .mdi {
        font-size: 18px;
        vertical-align: middle; /* Alignement vertical au centre */
        margin-right: 5px; /* Ajout de la marge à droite pour séparer l'icône du texte */
    }
    
</style>

<div id="tree"></div>

<script>
    function traverseNestedDictionary(obj, parentElement, isRoot = false) {
        var ul = document.createElement('ul');
        parentElement.appendChild(ul);
    
        for (var key in obj) {
            if (obj.hasOwnProperty(key)) {
                var li = document.createElement('li');
                ul.appendChild(li);
    
                var span = document.createElement('span');
                span.textContent = key + ": ";
                li.appendChild(span);
    
                // Si la valeur est un autre objet, appel récursif de la fonction pour ce sous-objet
                if (typeof obj[key] === 'object' && obj[key] !== null) {
                    traverseNestedDictionary(obj[key], li, false);
    
                    // Ajout d'un gestionnaire d'événements pour montrer/cacher les enfants
                    spani.addEventListener('click', function(e) {
                        e.stopPropagation();  // Empêche la propagation de l'événement aux parents
    
                        var ul = this.parentElement.querySelector('ul');
                        if (ul) {
                            ul.classList.toggle('hidden');
    
                            // Changer l'icône en fonction de l'état
                            var icon = this.querySelector('.mdi');
                            if (ul.classList.contains('hidden')) {
                                icon.classList.remove('mdi-chevron-down');
                                icon.classList.add('mdi-chevron-right');
                            } else {
                                icon.classList.remove('mdi-chevron-right');
                                icon.classList.add('mdi-chevron-down');
                            }
                        }
                    });
    
                    // Ajout d'une icône de chevron pour indiquer les éléments avec des enfants
                    var icon = document.createElement('span');
                    icon.className = 'mdi mdi-chevron-right';  // Icône par défaut
                    span.appendChild(icon);
    
                    if (Object.keys(obj[key]).length > 0) {
                        // L'élément a des enfants, utilisez une icône de chevron
                        icon.classList.add('has-children');
                    } else {
                        // L'élément n'a pas d'enfants, masquez l'icône
                        icon.style.display = 'none';
                    }
                } else {
                    // Si la valeur n'est pas un objet, affichez-la directement
                    var leafSpan = document.createElement('span');
                    leafSpan.textContent = obj[key];
                    li.appendChild(leafSpan);
                }
            }
        }
    }
    
    var serializedData = {}
    var serializedData = {{serializer_data|safe}};
    // Utiliser la structure JavaScript dans la console log
    console.log(serializedData);
    var treeContainer = document.getElementById('tree');
    traverseNestedDictionary(serializedData, treeContainer, true);
    
</script>

{% endblock %}
